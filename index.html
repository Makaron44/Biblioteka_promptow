<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Prompt Library 7.1 (No Zoom Fix)</title>
    <style>
        /* --- 1. ZMIENNE KOLOR√ìW --- */
        :root {
            --primary: #4a90e2;
            --success: #2ecc71;
            --warning: #f39c12;
            --danger: #e74c3c;
            --info: #8e44ad;
            
            --bg-body: #f7f9fc;
            --bg-card: #ffffff;
            --bg-input: #ffffff;
            --text-main: #2c3e50;
            --text-muted: #636e72;
            --border: #dfe6e9;
            --shadow: 0 4px 6px rgba(0,0,0,0.1);
            --code-bg: #f8f9fa;
            --note-bg: #fff8e1;
            --note-border: #ffe082;
            --note-text: #5d4037;
        }

        body.dark-mode {
            --bg-body: #121212;
            --bg-card: #1e1e1e;
            --bg-input: #2d2d2d;
            --text-main: #ecf0f1;
            --text-muted: #b2bec3;
            --border: #444;
            --shadow: 0 4px 6px rgba(0,0,0,0.5);
            --code-bg: #2d2d2d;
            --note-bg: #3e3e28;
            --note-border: #665c26;
            --note-text: #fff9c4;
        }

        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-body);
            color: var(--text-main);
            margin: 0;
            padding: 0;
            line-height: 1.6;
            padding-bottom: 50px;
            transition: background-color 0.3s, color 0.3s;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
        }

        .header-row {
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            margin-bottom: 20px;
        }
        h1 { margin: 0; font-size: 1.8rem; color: var(--text-main); }
        #themeToggleBtn {
            position: absolute;
            right: 0;
            background: none;
            border: 2px solid var(--border);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            font-size: 20px;
            cursor: pointer;
            color: var(--text-main);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }
        #themeToggleBtn:hover { background-color: var(--border); }

        .search-wrapper {
            position: sticky;
            top: 0;
            background-color: var(--bg-body);
            padding: 10px 0;
            z-index: 100;
            transition: background-color 0.3s;
        }
        #searchInput {
            width: 100%;
            padding: 15px;
            border: 2px solid var(--border);
            border-radius: 30px;
            font-size: 16px; /* To chroni≈Ço wyszukiwarkƒô przed zoomem */
            outline: none;
            box-shadow: var(--shadow);
            background-color: var(--bg-card);
            color: var(--text-main);
            transition: border-color 0.3s;
            box-sizing: border-box;
        }
        #searchInput:focus { border-color: var(--primary); }

        .form-container {
            background: var(--bg-card);
            padding: 20px;
            border-radius: 12px;
            box-shadow: var(--shadow);
            margin-bottom: 30px;
            border: 2px solid transparent;
            transition: border-color 0.3s, background-color 0.3s;
        }
        .form-container.editing-mode { border-color: var(--warning); }
        .form-title { margin-top: 0; font-size: 1.2rem; margin-bottom: 15px; color: var(--text-main); }

        /* --- TU JEST POPRAWKA --- */
        input.input-field, textarea.input-field {
            width: 100%;
            padding: 12px;
            margin-bottom: 12px;
            border: 1px solid var(--border);
            border-radius: 8px;
            box-sizing: border-box;
            font-family: inherit;
            background-color: var(--bg-input);
            color: var(--text-main);
            
            /* KLUCZOWE: Wymuszenie 16px blokuje zoom na iPhone */
            font-size: 16px; 
        }

        #inputNote { border-style: dashed; }

        button#save-btn {
            width: 100%;
            background-color: var(--success);
            color: white;
            padding: 14px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
        }
        button#save-btn:active { transform: scale(0.98); }
        button#save-btn.edit-btn-active { background-color: var(--warning); }

        .settings-panel {
            background: var(--bg-card);
            border: 1px solid var(--border);
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }
        .settings-title { font-weight: bold; font-size: 0.9rem; color: var(--text-muted); width: 100%; margin-bottom: 5px; }
        .io-btn {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            color: white;
            text-align: center;
            background-color: #34495e;
        }
        .io-btn:hover { opacity: 0.9; }
        #fileInput { display: none; }

        .prompt-card {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
            transition: transform 0.2s, background-color 0.3s;
            border-left: 6px solid var(--primary);
        }
        .prompt-card:hover { transform: translateY(-3px); }

        .prompt-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        .prompt-title { font-weight: 700; font-size: 1.1rem; color: var(--primary); }
        
        .prompt-content {
            background: var(--code-bg);
            padding: 15px;
            border-radius: 8px;
            white-space: pre-wrap;
            font-family: 'Consolas', monospace;
            font-size: 0.95rem;
            color: var(--text-main);
            overflow-x: auto;
            border: 1px solid var(--border);
        }

        .prompt-note-block {
            margin-top: 15px;
            background-color: var(--note-bg);
            border: 1px solid var(--note-border);
            color: var(--note-text);
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 0.9rem;
            display: flex;
            gap: 10px;
            align-items: flex-start;
        }
        .note-icon { font-size: 1.2em; }
        .note-text { white-space: pre-wrap; }

        .prompt-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 15px;
            flex-wrap: wrap;
            gap: 15px;
        }
        .prompt-tags {
            font-size: 0.85rem;
            color: var(--text-muted);
            background: var(--bg-input);
            padding: 4px 8px;
            border-radius: 4px;
            border: 1px solid var(--border);
        }

        .actions { display: flex; gap: 10px; align-items: center; }
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .copy-btn { background-color: var(--primary); color: white; }
        .edit-btn { background-color: var(--warning); color: white; }
        .delete-btn { background-color: transparent; color: var(--danger); border: 1px solid var(--danger); }
        
        #loadMoreBtn {
            display: block;
            width: 100%;
            padding: 15px;
            background-color: transparent;
            border: 2px dashed var(--border);
            color: var(--text-muted);
            font-size: 16px;
            cursor: pointer;
            border-radius: 8px;
            margin-bottom: 40px;
            transition: all 0.3s;
        }
        #loadMoreBtn:hover { border-color: var(--primary); color: var(--primary); background-color: var(--bg-card); }
        #loadMoreBtn.collapse-mode { border-color: var(--primary); background-color: rgba(74, 144, 226, 0.1); color: var(--primary); }
        .hidden { display: none !important; }

        @media (max-width: 600px) {
            .container { padding: 10px; }
            h1 { font-size: 1.4rem; }
            .prompt-footer { flex-direction: column; align-items: flex-start; }
            .actions { width: 100%; margin-top: 10px; }
            .btn { flex: 1; justify-content: center; padding: 12px; }
        }
    </style>
</head>
<body>

<div class="container">
    <div class="header-row">
        <h1>üìö Biblioteka Prompt√≥w</h1>
        <button id="themeToggleBtn" onclick="toggleTheme()">üåô</button>
    </div>

    <div class="search-wrapper">
        <input type="text" id="searchInput" placeholder="üîç Szukaj..." onkeyup="handleSearch()">
    </div>

    <div class="settings-panel">
        <div class="settings-title">‚öôÔ∏è ZarzƒÖdzanie danymi</div>
        <button class="io-btn export-btn" onclick="exportData()">‚¨áÔ∏è Eksportuj</button>
        <button class="io-btn import-btn" onclick="document.getElementById('fileInput').click()">‚¨ÜÔ∏è Importuj</button>
        <input type="file" id="fileInput" accept=".json" onchange="importData(this)">
    </div>

    <div class="form-container" id="mainForm">
        <h3 class="form-title" id="formHeader">Dodaj nowy wpis</h3>
        <input type="text" class="input-field" id="inputTitle" placeholder="Tytu≈Ç promptu">
        <textarea class="input-field" id="inputContent" rows="3" placeholder="Tre≈õƒá promptu..."></textarea>
        <textarea class="input-field" id="inputNote" rows="2" placeholder="üí° Notatki / Instrukcja..."></textarea>
        <input type="text" class="input-field" id="inputTags" placeholder="Tagi (np. #python, #seo)">
        <button id="save-btn" onclick="savePrompt()">‚ûï Dodaj Prompt</button>
    </div>

    <div id="promptList"></div>
    <button id="loadMoreBtn"></button>
</div>

<script>
    let prompts = JSON.parse(localStorage.getItem('myPrompts')) || [];
    let itemsToShow = 5; 
    let currentFilteredList = []; 
    let editingId = null;

    init();

    function init() {
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme === 'dark') {
            document.body.classList.add('dark-mode');
            document.getElementById('themeToggleBtn').innerText = '‚òÄÔ∏è';
        }
        currentFilteredList = prompts;
        renderList();
    }

    function toggleTheme() {
        const body = document.body;
        const btn = document.getElementById('themeToggleBtn');
        body.classList.toggle('dark-mode');
        if (body.classList.contains('dark-mode')) {
            btn.innerText = '‚òÄÔ∏è';
            localStorage.setItem('theme', 'dark');
        } else {
            btn.innerText = 'üåô';
            localStorage.setItem('theme', 'light');
        }
    }

    function exportData() {
        if (prompts.length === 0) { alert("Brak danych!"); return; }
        const dataStr = JSON.stringify(prompts, null, 2);
        const blob = new Blob([dataStr], { type: "application/json" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        const date = new Date().toISOString().split('T')[0];
        a.download = `prompty_backup_${date}.json`;
        a.click();
        URL.revokeObjectURL(url);
    }

    function importData(input) {
        const file = input.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = function(e) {
            try {
                const importedData = JSON.parse(e.target.result);
                if (Array.isArray(importedData)) {
                    if(confirm(`Wczytaƒá ${importedData.length} prompt√≥w?`)) {
                        prompts = importedData;
                        saveData();
                        currentFilteredList = prompts;
                        itemsToShow = 5;
                        renderList();
                        alert("‚úÖ Gotowe!");
                    }
                } else { alert("B≈ÇƒÖd formatu pliku."); }
            } catch (err) { alert("B≈ÇƒÖd odczytu pliku."); }
            input.value = '';
        };
        reader.readAsText(file);
    }

    function renderList() {
        const listContainer = document.getElementById('promptList');
        const loadMoreBtn = document.getElementById('loadMoreBtn');
        listContainer.innerHTML = '';

        if (currentFilteredList.length === 0) {
            listContainer.innerHTML = '<p style="text-align:center; color: var(--text-muted);">Brak wynik√≥w.</p>';
            loadMoreBtn.classList.add('hidden');
            return;
        }

        const visiblePrompts = currentFilteredList.slice(0, itemsToShow);

        visiblePrompts.forEach(prompt => {
            let noteHTML = '';
            if (prompt.note && prompt.note.trim() !== '') {
                noteHTML = `
                    <div class="prompt-note-block">
                        <span class="note-icon">üí°</span>
                        <span class="note-text">${prompt.note}</span>
                    </div>
                `;
            }

            const promptHTML = `
                <div class="prompt-card">
                    <div class="prompt-header">
                        <span class="prompt-title">${prompt.title}</span>
                    </div>
                    <div class="prompt-content">${prompt.content}</div>
                    ${noteHTML}
                    <div class="prompt-footer">
                        <span class="prompt-tags">üè∑Ô∏è ${prompt.tags || 'brak'}</span>
                        <div class="actions">
                            <button class="btn copy-btn" onclick="copyToClipboard(${prompt.id})">üìã</button>
                            <button class="btn edit-btn" onclick="startEdit(${prompt.id})">‚úèÔ∏è</button>
                            <button class="btn delete-btn" onclick="deletePrompt(${prompt.id})">üóëÔ∏è</button>
                        </div>
                    </div>
                </div>
            `;
            listContainer.innerHTML += promptHTML;
        });

        if (currentFilteredList.length <= 5) {
            loadMoreBtn.classList.add('hidden');
        } else if (itemsToShow < currentFilteredList.length) {
            loadMoreBtn.classList.remove('hidden');
            loadMoreBtn.classList.remove('collapse-mode');
            const remaining = currentFilteredList.length - itemsToShow;
            loadMoreBtn.innerText = `‚¨áÔ∏è Poka≈º wiƒôcej (jeszcze ${remaining})`;
            loadMoreBtn.onclick = loadMore;
        } else {
            loadMoreBtn.classList.remove('hidden');
            loadMoreBtn.classList.add('collapse-mode');
            loadMoreBtn.innerText = `‚¨ÜÔ∏è Zwi≈Ñ listƒô`;
            loadMoreBtn.onclick = collapseList;
        }
    }

    function loadMore() { itemsToShow += 5; renderList(); }
    function collapseList() { itemsToShow = 5; renderList(); document.getElementById('mainForm').scrollIntoView({ behavior: 'smooth', block: 'end' }); }

    function startEdit(id) {
        const promptToEdit = prompts.find(p => p.id === id);
        if (!promptToEdit) return;
        document.getElementById('inputTitle').value = promptToEdit.title;
        document.getElementById('inputContent').value = promptToEdit.content;
        document.getElementById('inputNote').value = promptToEdit.note || ''; 
        document.getElementById('inputTags').value = promptToEdit.tags;
        editingId = id;
        const saveBtn = document.getElementById('save-btn');
        const formContainer = document.getElementById('mainForm');
        saveBtn.innerText = "üíæ Zapisz zmiany";
        saveBtn.classList.add('edit-btn-active'); 
        formContainer.classList.add('editing-mode'); 
        document.getElementById('formHeader').innerText = "Edytujesz wpis...";
        formContainer.scrollIntoView({ behavior: 'smooth' });
    }

    function savePrompt() {
        const title = document.getElementById('inputTitle').value;
        const content = document.getElementById('inputContent').value;
        const note = document.getElementById('inputNote').value; 
        const tags = document.getElementById('inputTags').value;

        if (!title || !content) { alert("Tytu≈Ç i tre≈õƒá sƒÖ wymagane!"); return; }

        if (editingId) {
            const index = prompts.findIndex(p => p.id === editingId);
            if (index !== -1) {
                prompts[index].title = title;
                prompts[index].content = content;
                prompts[index].note = note; 
                prompts[index].tags = tags;
            }
        } else {
            const newPrompt = { id: Date.now(), title, content, note, tags };
            prompts.unshift(newPrompt);
        }
        saveData();
        resetForm();
        document.getElementById('searchInput').value = '';
        currentFilteredList = prompts;
        itemsToShow = 5; 
        renderList();
    }

    function resetForm() {
        document.getElementById('inputTitle').value = '';
        document.getElementById('inputContent').value = '';
        document.getElementById('inputNote').value = ''; 
        document.getElementById('inputTags').value = '';
        editingId = null;
        const saveBtn = document.getElementById('save-btn');
        const formContainer = document.getElementById('mainForm');
        saveBtn.innerText = "‚ûï Dodaj Prompt";
        saveBtn.classList.remove('edit-btn-active');
        formContainer.classList.remove('editing-mode');
        document.getElementById('formHeader').innerText = "Dodaj nowy wpis";
    }

    function handleSearch() {
        const searchText = document.getElementById('searchInput').value.toLowerCase();
        currentFilteredList = prompts.filter(p => 
            p.title.toLowerCase().includes(searchText) || 
            p.content.toLowerCase().includes(searchText) ||
            (p.note && p.note.toLowerCase().includes(searchText)) || 
            p.tags.toLowerCase().includes(searchText)
        );
        itemsToShow = 5; renderList();
    }

    function deletePrompt(id) {
        if(confirm("UsunƒÖƒá?")) {
            if (editingId === id) resetForm();
            prompts = prompts.filter(p => p.id !== id);
            saveData();
            handleSearch(); 
        }
    }

    function copyToClipboard(id) {
        const item = prompts.find(p => p.id === id);
        if(item) { navigator.clipboard.writeText(item.content).then(() => alert("‚úÖ Skopiowano!")); }
    }

    function saveData() { localStorage.setItem('myPrompts', JSON.stringify(prompts)); }
</script>

</body>
</html>
